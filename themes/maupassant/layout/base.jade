include _partial/helpers

if page.title
  - var current_title = page.title
else
  - var current_title = config.title

if config.feed
  case config.feed.type
    when 'rss2'
      - var feed_type='application/rss+xml'
    when 'atom'
    default
      - var feed_type='application/atom+xml'

if is_post()
  if page.summary
    - var card_description = page.summary
  else
    - var stripped_content = strip_html(page.content);
    - var end_index = stripped_content.indexOf('.') + 1 || 100;
    - var card_description = stripped_content.substring(0, end_index)
  if page.image
    - var card_image = url.substring(0, url.lastIndexOf('/') + 1) + page.image;
    - var card_type = "summary_large_image"
  else
    - var card_type = "summary"
else
  - var card_description = current_title

doctype html
html(lang='#{config.language}')
  head
    meta(http-equiv='content-type', content='text/html; charset=utf-8')
    meta(content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0', name='viewport')
    meta(content='yes', name='apple-mobile-web-app-capable')
    meta(content='black-translucent', name='apple-mobile-web-app-status-bar-style')
    meta(content='telephone=no', name='format-detection')
    meta(name='description', content=config.description)
    meta(name='twitter:card' content=card_type)
    meta(name='twitter:site' content='@daiyitastic')
    meta(name='twitter:creator' content='@daiyitastic')
    meta(name='twitter:description' content=card_description)
    meta(name='twitter:image' content=card_image)
    meta(property='og:url' content=url)
    meta(property='og:title' content=current_title)
    meta(property='og:description' content=card_description)
    meta(property='og:image' content=card_image)
    block title
    link(rel='stylesheet', type='text/css', href='//cdn.bootcss.com/normalize/4.2.0/normalize.min.css')
    link(rel='stylesheet', type='text/css', href='//cdn.bootcss.com/pure/0.6.0/pure-min.css')
    link(rel='stylesheet', type='text/css', href='//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css')
    link(rel='stylesheet', type='text/css', href=url_for(theme.css) + '/style.css' + '?v=' + theme.version)
    link(rel='stylesheet', href='//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css')
    script(type='text/javascript', src='//cdn.bootcss.com/jquery/3.0.0/jquery.min.js')
    link(rel='Shortcut Icon', type='image/x-icon', href=url_for('favicon.ico'))
    link(rel='apple-touch-icon', href=url_for('apple-touch-icon.png'))
    link(rel='apple-touch-icon-precomposed', href=url_for('apple-touch-icon.png'))
    if config.feed
      link(rel='alternate', type=feed_type, href=url_for(config.feed.path))

  body: .body_container
    #header
      .site-name
        h1.hidden= current_title
        a#logo(href=url_for('.'))= config.title
        p.description= config.subtitle
      #nav-menu
        - for (var i in theme.menu)
          +a_with_current(theme.menu[i].directory, __(theme.menu[i].page))

    #layout.pure-g
      .pure-u-1.pure-u-md-3-4: .content_container
        block content
      if theme.widgets_on_small_screens
        .pure-u-1.pure-u-md-1-4: #sidebar
          each item in theme.widgets
            != partial('_widget/' + item + '.jade')
      else
        .pure-u-1-4.hidden_mid_and_down: #sidebar
          each item in theme.widgets
            != partial('_widget/' + item + '.jade')
      //- show widgets at bottom on small screens
      .pure-u-1.hidden_mid_and_up: .content_container: #sidebar
        each item in theme.widgets
          != partial('_widget/' + item + '.jade')
      //- .pure-u-1.pure-u-md-3-4
      //-   != partial('_partial/footer.jade')

    include _partial/after_footer
